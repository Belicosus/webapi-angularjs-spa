window.app=angular.module("resourceManagerApp",["ui.select2","ngRoute","ngResource","ngAnimate"]).config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,r){t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/login/Login.html"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),r.interceptors.push("authorizationInterceptor"),r.interceptors.push("httpInterceptor")}]);
!function e(t,r,o){function i(n,s){if(!r[n]){if(!t[n]){var c="function"==typeof require&&require;if(!s&&c)return c(n,!0);if(l)return l(n,!0);throw new Error("Cannot find module '"+n+"'")}var p=r[n]={exports:{}};t[n][0].call(p.exports,function(e){var r=t[n][1][e];return i(r?r:e)},p,p.exports,e,t,r,o)}return r[n].exports}for(var l="function"==typeof require&&require,n=0;n<o.length;n++)i(o[n]);return i}({1:[function(){window.app=angular.module("resourceManagerApp",["ui.select2","ngRoute","ngResource","ngAnimate"]).config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,r){t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/login/Login.html"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),r.interceptors.push("authorizationInterceptor"),r.interceptors.push("httpInterceptor")}])},{}]},{},[1]);
app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(r,o,t){return{responseError:function(e){switch(e.status){case 401:r.$broadcast("logOff"),t.url("/Login");break;case 403:t.url("/Login")}return o.reject(e)}}}]);
app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(t,i,e){t.deleteActivity=function(i){return confirm("Do you want to remove this activity?")&&e.deleteActivity(i).then(function(){t.activities=e.getActivites(i.ResourceId)}),!1}}]);
app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(t,c,i,o){t.activity={resourceId:i.resourceId},t.addActivity=function(t){o.addActivity(t).then(function(t){c.url("/Resources/"+t.ResourceId)})}}]);
app.controller("HomeCtrl",["$scope","resourceSvc",function(e,o){function c(){r()}function r(){e.resources=o.getTopFiveResources()}c()}]);
app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(o,n,t,c){function i(){t.locationId>0&&(o.location=c.getLocation(t.locationId))}o.addLocation=function(o){c.addLocation(o).then(function(){n.url("/Locations")})},o.editLocation=function(o){c.editLocation(o).then(function(){n.url("/Locations")})},i()}]);
app.controller("LocationsCtrl",["$scope","confirmSvc","locationSvc",function(o,t,n){function c(){i()}function i(){o.locations=n.getLocations()}o.locations=[],c(),o.deleteLocation=function(o){t.confirm("Do you want to delete this item?")&&n.deleteLocation(o).then(function(){i()})}}]);
app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc",function(e,o,r,c){function s(){o.resourceId>0?e.resource=c.getResource(o.resourceId):e.locations=c.createResourceAddFormModel()}e.resource={hasActivites:!1},e.addResource=function(e){c.addResource(e).then(function(){r.url("/Resources")})},s()}]);
app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,o,r,t){function c(){for(var e=[],o=1;10>=o;o++)e.push({priority:o});return e}function n(){t.createResourceEditFormModel(r.resourceId).then(function(o){e.locations=o[1],e.resource=o[0],e.priorities=c()})}n(),e.editResource=function(e){t.editResource(e).then(function(){o.url("/Resources")})}}]);
app.controller("ResourcesCtrl",["$scope","resourceSvc","confirmSvc",function(e,o,c){function r(){t()}function t(){e.resources=o.getResources()}e.resources=[],e.deleteResource=function(e){c.confirm("Are you sure you want to delete this item?")&&o.deleteResource(e).then(function(){t()})},r()}]);
app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(e,o,r){e.loginMode=!0,e.registrationMode=!1,e.loaded=!0,e.login=function(n,t){e.loaded=!1,t.Action=0,e.errorMessage="",r.login(t).then(function(){e.loaded=!0,e.$emit("logOn"),o.url("/Home")},function(o){e.loaded=!0,e.errorMessage=404==o.status?o.data:"An error occured while performing this action. Please try after some time."})},e.toggleMode=function(o){e.errorMessage="","login"===o?(e.loginMode=!0,e.registrationMode=!1):"register"===o&&(e.loginMode=!1,e.registrationMode=!0)},e.register=function(n){return n.password!==n.confirmPassword?void(e.errorMessage="Passwords do not match"):(e.loaded=!1,e.errorMessage="",n.Action=1,void r.registerUser(n).then(function(){e.loaded=!0,e.$emit("logOn"),o.url("/Home")},function(){e.loaded=!0,e.errorMessage="An error occured while performing this action. Please try after some time."}))},e.logOff=function(){r.logOffUser().then(function(){e.$emit("logOff"),e.loginMode=!0,e.registrationMode=!1,o.url("/Login")},function(){})}}]);
app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}});
app.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,t,i,n){t.datepicker({maxDate:0,onSelect:function(t){n.$setViewValue(t),e.$apply(),n.$setValidity("invalid",!1)}});t.on("keypress",function(){return!1})}}});
app.directive("cstDelete",function(){return{replace:!0,link:function(e,n){console.log(n),n.on("click",function(){return confirm("Delete item?")})}}});
app.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor",function(e,t,n){function r(e){e.removeClass("hide"),e.addClass("show")}function o(e){e.removeClass("show"),e.addClass("hide")}return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(s,c){var i=[];n.request=function(e){return console.log("request: "+e.url),i.push({}),1==i.length&&r(c),e||t.when(e)},n.response=function(n){return console.log("response: "+n.config.url),i.pop(),0==i.length&&e(function(){0==i.length&&o(c)},500),n||t.when(n)},n.responseError=function(n){return i.pop(),0==i.length&&e(function(){0==i.length&&o(c)},500),t.reject(n)}}}}]),app.factory("httpInterceptor",function(){return{}});
app.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(n,c,i){c.on("click",function(){var n="#"+i.cstModal;$(n).modal("show")})}}});

app.directive("cstSelect2Dropdown",function(){return{require:"ngModel",link:function(e,n,t,l){var c=n.select2();c.on("change",function(n){alert($(this).select2("val")),l.$setViewValue(n.val),e.$apply()})}}});
app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(t,n){var i=n.find("a");i.on("click",function(){i.removeClass("active"),$(this).addClass("active")}),t.$on("logOff",function(){t.isAuthenticated=!1}),t.$on("logOn",function(){t.isAuthenticated=!0})}}});
app.service("activitySvc",["$resource",function(e){var t=e("/api/Resources/:resourceId/Activities/:activityId",{resourceId:"@ResourceId",activityId:"@Id"},{"delete":{method:"delete",url:"/api/ResourceActivities/:activityId"}});return{addActivity:function(e){return t.save({resourceId:e.resourceId},e).$promise},deleteActivity:function(e){return t.delete({activityId:e.Id}).$promise},getActivites:function(e){return t.query({resourceId:e})}}}]);
app.factory("locationSvc",["$resource",function(o){var t=o("/api/Locations/:locationId",{locationId:"@Id"},{update:{method:"PUT"}});return{addLocation:function(o){return t.save(o).$promise},editLocation:function(o){var n=t.update(o);return n.$promise},getLocation:function(o){return t.get({locationId:o})},getLocations:function(){return t.query()},deleteLocation:function(o){return t.delete({locationId:o}).$promise}}}]);
app.factory("resourceSvc",["$resource","$q","locationSvc",function(e,r,o){var t=e("/api/Resources/:resourceId",{resourceId:"@Id"},{update:{method:"PUT"}});return{getTopFiveResources:function(){return t.query({count:5})},getResources:function(){return t.query()},deleteResource:function(e){return t.delete({resourceId:e})},addResource:function(e){return t.save(e).$promise},editResource:function(e){return t.update(e).$promise},getResource:function(e){return t.get({resourceId:e})},createResourceAddFormModel:function(){return o.getLocations()},createResourceEditFormModel:function(e){var t=r.all([this.getResource(e).$promise,o.getLocations().$promise]);return t.then(function(e){return e}),t}}}]);
app.service("confirmSvc",function(){return{confirm:function(r){if("string"==typeof r)return confirm(r);throw Error("Invalid type as msg")}}});
app.factory("errorMngrSvc",function(){return{handleError:function(){}}});
app.factory("resourceMngrSvc",["$http","$resource","$q",function(r,e,t){var o=e("/api/User/",null,{register:{method:"post"},login:{method:"post"},logOff:{method:"put"}});return{login:function(r){return o.login(r).$promise},registerUser:function(r){return o.register(r).$promise},checkUserAuthentication:function(){var e=t.defer();return r({method:"get",url:this.loginUrl}).success(function(r){e.resolve(r)}).error(function(r){e.reject(r)}),e.promise},logOffUser:function(){return o.logOff().$promise}}}]);